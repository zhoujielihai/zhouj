<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <select id="sel" onchange="getChange()">
        <option value="1">lt8</option>
        <option value="2">lt15</option>
        <option value="3">lt30</option>
        <option value="4">suv</option>
    </select>
    <table border="1" cellspacing="0" align="center">
        <thead>
            <tr>
                <th>汽车名称</th>
                <th>汽车图片</th>
                <th>汽车价格</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
    <script>
        function getChange(){
            var tid=sel.value;
            // console.log(tid);
            loadData(tid);
            return tid;
        }
        function loadData(tid){
            var xhr=new XMLHttpRequest();
            xhr.onreadystatechange=function(){
                if(xhr.readyState==4&&xhr.status==200){
                    var data=JSON.parse(xhr.responseText);
                    //  console.log(data);
                     //[{},{},{}]
                     var html="";
                     for(var i=0;i<data.length;i++){
                        //  console.log(data[i]);
                         var list=data[i];
                         html+=`
                            <tr>
                                <td>${list.cname}</td>
                                <td><img src="img/${list.pic}"></td>
                                <td>${list.price}</td>
                                <td>
                                    <a href="javascript:del(${list.cid})">删除</a>
                                    <a href="details.html?cid=${list.cid}">详情</a>
                                </td>  
                            </tr>
                         `
                     }
                     tbody.innerHTML=html;
                }
            }
            xhr.open("get","http://127.0.0.1:3000/car/carlist?tid="+tid,true);
            xhr.send(null);
        }
        loadData(1);
        function del(cid){
            var xhr=new XMLHttpRequest();
            xhr.onreadystatechange=function(){
                if(xhr.readyState==4&&xhr.status==200){
                    var data=JSON.parse(xhr.responseText);
                    alert(data.msg);
                    var tid=getChange()
                    loadData(tid)
                }
            }
            xhr.open("get","http://127.0.0.1:3000/car/cardel?cid="+cid,true);
            xhr.send(null);
        }
     
   </script>
</body>
</html>